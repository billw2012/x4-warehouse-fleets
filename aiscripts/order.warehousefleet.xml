<?xml version="1.0" encoding="utf-8"?>
<aiscript name="WarehouseFleet" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="C:/Spiele/Steam/steamapps/common/X4 Foundations/unpacked/libraries/aiscripts.xsd" version="31">

    <order id="WarehouseFleet" name="WarehouseFleet" description="Warehouse Fleet" category="trade" infinite="true">
        <params>

            <param name="sourceStation" required="true" type="object" text="Home Warehouse">
                <!-- TODO: Umbenennen -->
                <input_param name="class" value="[class.station]" />
                <input_param name="owner" value="this.ship.trueowner" />
            </param>
            <param name="targetStations" type="list" default="[]" text="Adjacent Warehouses">
                <input_param name="type" value="'object'" />
                <input_param name="class" value="[class.station]" />
                <input_param name="owner" value="this.ship.trueowner" />
            </param>
            <param name="serviceArea" type="list" default="[]" text="Extended Service Area">
                <input_param name="type" value="'object'" />
                <input_param name="class" value="[class.station, class.sector]" />
            </param>
            <param name="blacklistM" type="list" default="[]" text="Blacklist (M)">
                <input_param name="type" value="'object'" />
                <input_param name="class" value="[class.station, class.sector]" />
            </param>
            <param name="blacklistL" type="list" default="[]" text="Blacklist (L)">
                <input_param name="type" value="'object'" />
                <input_param name="class" value="[class.station, class.sector]" />
            </param>

            <param name="prioDistribution" default="5" type="number" text="Prio: Distribute">
                <input_param name="min" value="0" />
                <input_param name="max" value="10" />
            </param>
            <param name="prioTrade" default="5" type="number" text="Prio: Trade">
                <input_param name="min" value="0" />
                <input_param name="max" value="10" />
            </param>
            <param name="prioBuild" default="5" type="number" text="Prio: Supply Build Storage">
                <input_param name="min" value="0" />
                <input_param name="max" value="10" />
            </param>
            <param name="prioStorageVsProfit" default="5" type="number" text="Prio: Storage &lt;-&gt; Profit">
                <input_param name="min" value="0" />
                <input_param name="max" value="10" />
            </param>
            <param name="minCargoUsage" default="80" type="number" text="Min. Cargo Usage (%)">
                <input_param name="min" value="10" />
                <input_param name="max" value="100" />
            </param>
            <param name="tradeGatePenalty" default="20" type="number" text="Trades: Gate Penalty (%)">
                <input_param name="min" value="0" />
                <input_param name="max" value="90" />
            </param>
            <param name="sellWares" type="list" default="[]" text="Sell Wares">
                <input_param name="type" value="'ware'" />
            </param>
            <param name="sellPublicWares" type="bool" default="true" text="Include public sell offers">
                <input_param name="type" value="'ware'" />
            </param>
            <param name="buyWares" type="list" default="[]" text="Buy Wares">
                <input_param name="type" value="'ware'" />
            </param>
            <param name="buyPublicWares" type="bool" default="true" text="Include public buy offers">
                <input_param name="type" value="'ware'" />
            </param>
        </params>
        <requires>
            <match shiptype="shiptype.lasertower" negate="true" />
        </requires>
    </order>

    <interrupts>
        <!--
        <handler ref="SectorChangeHandler" />
        <handler ref="AttackHandler" />
        <handler ref="MissileLockHandler" />
        <handler ref="ScannedHandler" />
        <handler ref="InspectedHandler" />
        <handler ref="FoundAbandonedHandler" />
        <handler ref="FoundLockboxHandler" />
        <handler ref="ResupplyHandler" />
        <handler ref="TargetInvalidHandler" />
        <handler ref="TideHandler" />
-->
    </interrupts>

    <init>
        <debug_to_file chance="100" name="this.ship.idcode" directory="'WarehouseFleets'" text="'Konto vor init: ' + this.ship.money" output="false" append="true" />
        <set_order_syncpoint_reached order="this.assignedcontrolled.order" />
        <!--share_object_account object="this.ship" otherobject="$sourceStation" transferto="$sourceStation" />
        <debug_to_file chance="100" name="this.ship.idcode" directory="'WarehouseFleets'" text="'Konto nach init: ' + this.ship.money" output="false" append="true" /-->
    </init>

    <attention min="unknown">
        <actions>

            <!-- Scheduling versuchen -->
            <set_command command="command.searchtrades" />
            <set_command_action commandaction="commandaction.searchingtrades" />
            <signal_objects object="player.entity" param="'RequestWarehouseFleetScheduling'" param2="this.ship" />

            <!-- An Home Station docken -->
            <set_command_action commandaction="commandaction.docking" />
            <run_script name="'order.dock'" result="$docksuccess">
                <param name="destination" value="$sourceStation" />
                <param name="trading" value="true" />
            </run_script>

            <!-- Regelmäßig neue Schedulings versuchen -->
            <do_while value="true">
                <set_command_action commandaction="commandaction.searchingtrades" />
                <signal_objects object="player.entity" param="'RequestWarehouseFleetScheduling'" param2="this.ship" />
                <wait min="30s" max="60s" />
            </do_while>
        </actions>
    </attention>

    <on_abort>
        <debug_to_file chance="100" name="this.ship.idcode" directory="'WarehouseFleets'" text="'on_abort'" output="false" append="true" />
        <debug_to_file chance="100" name="this.ship.idcode" directory="'WarehouseFleets'" text="'Konto: ' + this.ship.money" output="false" append="true" />
    </on_abort>
</aiscript>